<section class="uk-overflow-auto">
    <div id="section">
        <ul class="uk-pagination uk-flex-center">
            <li class="uk-margin-auto"><a onclick="prevPage();"><span class="uk-margin-small-left" uk-pagination-previous></span><span class="uk-margin-small-left" uk-pagination-previous></span></a></li>
            <li class="uk-text-i">
<!--                onsubmit="sessionStorage.setItem('page', document.getElementById('npage').value); preventDefault(); getView('main-content', 'views/home.html', sessionStorage.getItem('page'));"-->
                <form method="post" id="search-page-by-number">
                    <input id="npage" name="npage" class="uk-input uk-form-width-xsmall uk-form-small uk-text-center" type="text">
                </form>
            </li>
            <li class="uk-margin-auto" id="next-page"></li>
        </ul>
        <div class="uk-text-i uk-text-light uk-text-center">
            <p class="uk-margin-auto" id="total-pages"></p>
        </div>
    </div>
    <div uk-filter="target: .js-filter; animation: 500">

        <ul class="uk-subnav uk-subnav-pill uk-child-width-auto@s uk-text-center">
            <li class="uk-active" uk-filter-control><a>All</a></li>
            <li uk-filter-control=".tag-movie"><a>Movies</a></li>
            <li uk-filter-control=".tag-series"><a>Series</a></li>
            <li uk-filter-control=".tag-game"><a>Games</a></li>
        </ul>
        <div class="uk-flex uk-flex-wrap uk-flex-center uk-child-width-auto uk-child-width-1-3@xl uk-child-width-1-3@l uk-child-width-1-3@m uk-child-width-1-2@s js-filter" id="flex"></div>
        <p id="error" class="uk-text-center uk-text-light uk-text-large uk-margin-large-top"></p>
    </div>
</section>
<script>
    ((e) => {
        const section = document.getElementById("next-page");
        document.getElementById("npage").placeholder = sessionStorage.getItem('page');
        const title = document.getElementById("title");
        title.innerHTML = '<h1><span class="white uk-text-bold">MOVIE </span><span class="lightpink uk-text-bold">RADAR</span></p>';
        const nav = document.getElementById("nav");
        const total_pages = document.getElementById("total-pages");
        const background = document.getElementById("background");
        background.style = "background-image: url(dist/img/movie_background.jpg);";

        const data =
            //onsubmit="sessionStorage.setItem('title', document.getElementById('search').value); sessionStorage.setItem('page', '1');"
            '<form id="search-form" class="uk-search uk-search-default"  method="post">' +
            '   <span class="uk-form-icon " uk-icon="icon: search"></span>' +
            '   <input id="search" class="uk-input uk-form-large" type="text" placeholder="Search what you want to watch..." autofocus>' +
            '</form>';

        nav.innerHTML = data;

        const search_form = document.getElementById('search-form');

        search_form.addEventListener('submit', function(event) {
            event.preventDefault();
            sessionStorage.setItem('title', document.getElementById('search').value);
            sessionStorage.setItem('page', '1');
            fetch('views/home' /*, options */)
                .then((response) => response)
                .then((response) => {
                    getView('main-content', 'views/home.html', Number(sessionStorage.getItem('page')));
                })
                .catch((error) => console.error(error));
            // getView('main-content', 'views/home.html', Number(sessionStorage.getItem('page')));
        });

        const search_page_by_number = document.getElementById('search-page-by-number');

        search_page_by_number.addEventListener('submit', function(event) {
            event.preventDefault();

            sessionStorage.setItem('page', document.getElementById('npage').value);
            fetch('views/home' /*, options */)
                .then((response) => response)
                .then((response) => {
                    getView('main-content', 'views/home.html', Number(sessionStorage.getItem('page')));
                })
                .catch((error) => console.error(error));
            // getView('main-content', 'views/home.html', Number(sessionStorage.getItem('page')));
        });

        /**
         * This fetch request gets the data from the omdbapi and loops through the results
         * @type {string}
         */
        let url2 = "https://www.omdbapi.com/?s=" + sessionStorage.getItem("title") + "&page=" + Number(sessionStorage.getItem('page')) + "&apikey=" + key;
        fetch(url2)
            .then((data) => data.json())
            .then((json) => {
                const section_data = '<a onclick="nextPage(' + json["totalResults"] + ');"><span class="uk-margin-small-right" uk-pagination-next></span><span class="uk-margin-small-right" uk-pagination-next></span></a>';
                section.innerHTML += section_data;

                total_pages.innerHTML = '<p>Total pages: '+ numPages(json["totalResults"]) +'</p>';

                const flex = document.getElementById('flex');

                if(json["Error"]) {
                    document.getElementById("error").innerHTML = 'There were no results found with ' + sessionStorage.getItem("title") + ', try a more specific search';
                }
                else {
                    const search = json["Search"];

                    search.map((search) => {
                        const data =
                            '<div class="uk-card uk-card-body tag-' + search["Type"] + '">' +
                            '   <div class="uk-card-media-top">' +
                            '       <a onclick="getView(\'main-content\', \'views/detail.html\', Number(sessionStorage.getItem(\'page\')));  sessionStorage.setItem(\'imdbID\', \'' + search["imdbID"] + '\')"><img src="' + search["Poster"] + '" alt="image"></a>' +
                            '   </div>' +
                            '   <div class="uk-card-footer uk-text-center">' +
                            '       <p><a class="uk-text-lead" onclick="getView(\'main-content\', \'views/detail.html\', Number(sessionStorage.getItem(\'page\')));  sessionStorage.setItem(\'imdbID\', \'' + search["imdbID"] + '\')">' + search["Title"] + '</a><br/>' + search["Year"] + ' &#183; ' + search["Type"] + '</p>' +
                            '   </div>' +
                            '</div>';
                        flex.innerHTML += data;
                    });
                }
            })
    })();
</script>
